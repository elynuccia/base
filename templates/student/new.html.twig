{% extends 'base.html.twig' %}
{% block title %}Student{% endblock title %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href={{ asset('css/addons-pro/bootstrap.min.css') }} >
    <link rel="stylesheet" href={{ asset('css/addons-pro/mdb.min.css') }} >
    <link rel="stylesheet" href={{ asset('css/addons-pro/cards-extended.min.css') }} >

    <style>.scrollbar-deep-purple::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
            background-color: #F5F5F5;
            border-radius: 10px; }

        .scrollbar-deep-purple::-webkit-scrollbar {
            width: 12px;
            background-color: #F5F5F5; }

        .scrollbar-deep-purple::-webkit-scrollbar-thumb {
            border-radius: 10px;
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
            background-color: #512da8; }

        .scrollbar-cyan::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
            background-color: #F5F5F5;
            border-radius: 10px; }

        .scrollbar-cyan::-webkit-scrollbar {
            width: 12px;
            background-color: #F5F5F5; }

        .scrollbar-cyan::-webkit-scrollbar-thumb {
            border-radius: 10px;
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
            background-color: #00bcd4; }

        .scrollbar-dusty-grass::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
            background-color: #F5F5F5;
            border-radius: 10px; }

        .scrollbar-dusty-grass::-webkit-scrollbar {
            width: 12px;
            background-color: #F5F5F5; }

        .scrollbar-dusty-grass::-webkit-scrollbar-thumb {
            border-radius: 10px;
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
            background-image: -webkit-linear-gradient(330deg, #d4fc79 0%, #96e6a1 100%);
            background-image: linear-gradient(120deg, #d4fc79 0%, #96e6a1 100%); }

        .scrollbar-ripe-malinka::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
            background-color: #F5F5F5;
            border-radius: 10px; }

        .scrollbar-ripe-malinka::-webkit-scrollbar {
            width: 12px;
            background-color: #F5F5F5; }

        .scrollbar-ripe-malinka::-webkit-scrollbar-thumb {
            border-radius: 10px;
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
            background-image: -webkit-linear-gradient(330deg, #f093fb 0%, #f5576c 100%);
            background-image: linear-gradient(120deg, #f093fb 0%, #f5576c 100%); }

        .bordered-deep-purple::-webkit-scrollbar-track {
            -webkit-box-shadow: none;
            border: 1px solid #512da8; }

        .bordered-deep-purple::-webkit-scrollbar-thumb {
            -webkit-box-shadow: none; }

        .bordered-cyan::-webkit-scrollbar-track {
            -webkit-box-shadow: none;
            border: 1px solid #00bcd4; }

        .bordered-cyan::-webkit-scrollbar-thumb {
            -webkit-box-shadow: none; }

        .square::-webkit-scrollbar-track {
            border-radius: 0 !important; }

        .square::-webkit-scrollbar-thumb {
            border-radius: 0 !important; }

        .thin::-webkit-scrollbar {
            width: 6px; }

        .example-1 {
            position: relative;
            overflow-y: scroll;
            height: 400px; }</style>
{% endblock %}


{% block main %}

    <div class="container-fluid">



        <section class="mb-5">

            <!--Card-->
            <div class="card card-cascade narrower">

                <!--Section: Chart-->
                <section>

                    <!--Grid row-->
                    <div class="row">

                        <!--Grid column-->
                        <div class="col-12 mr-0">

                            <!--Card image-->
                            <div class="view view-cascade gradient-card-header primary-color">
                                <h4 class="h4-responsive mb-0 ">Personal page</h4>
                            </div>
                            <!--/Card image-->

                            <!--Card content-->
                            <div class="card-body card-body-cascade pb-0">


                                <div class="row mt-lg-5">



                                    <!-- Card -->
                                    <div class="col-md-6 card testimonial-card">

                                        <!-- Background color -->
                                        <div class="card-up blue lighten-1"></div>

                                        <!-- Avatar -->
                                        <div class="avatar mx-auto white">
                                            <img src="{{ student.qrcode  }}">
                                        </div>

                                        <!-- Content -->
                                        <div class="card-body">
                                            <!-- Name -->
                                            <h4 class="card-title"><b>{{  student.nickname|default("Person In Charge") }}</b></h4>
                                            <hr>
                                            <!-- Quotation -->
                                            <p><b>My personal code: </b> {{ student.code }} <br></p>
                                            <p></i><b>Points gained: </b> {{ student.points }} <br></p>
                                        </div>

                                    </div>
                                    <!-- Card -->


                                    <div class="col-md-6">
                                        <!--Card-->
                                        <div class="card card-cascade cascading-admin-card">

                                            <!--Card Data-->
                                            <div class="admin-up">
                                                <div class="data">
                                                    {% set sumOdr = 0%}{% for behavior in odrs %}{% set sumOdr= sumOdr + behavior.countODR %}{% endfor %}
                                                    {% set sumPor = 0%}{% for behavior in pors %}{% set sumPor= sumPor + behavior.countPOR %}{% endfor %}
                                                    {% if (sumOdr+sumPor) == 0 %}<h4 class="section-heading mb-4 bold text-center">No available data</h4>
                                                    {% else %}
                                                        <h4 class="section-heading mb-4 bold text-center">{{ ((sumOdr/(sumOdr+sumPor))*100)|round(2,'ceil')}}% ODRs and  {{ ((sumPor/(sumOdr+sumPor))*100)|round(2,'ceil') }}% PORs</h4>
                                                    {% endif %}
                                                </div>
                                            </div>
                                            <div class="row"><div class="col-md-12"><br></div></div>
                                            <div class="row"><div class="col-md-12"><br></div></div>

                                            <!--/.Card Data-->

                                            <!--Card content-->
                                            <canvas id="doughnutChart"></canvas>
                                            <div class="row"><div class="col-md-12"><br></div></div>
                                            <div class="row"><div class="col-md-12"><br></div></div>
                                            <div class="row"><div class="col-md-12"><br></div></div>
                                            <div class="row"><div class="col-md-12"><br></div></div>
                                            <!--/.Card Data-->

                                            <!--Card content-->


                                            <!--/.Card content-->

                                        </div>
                                        <!--/.Card-->
                                    </div>
                                </div>




                            </div>
                            <!--/.Card content-->

                        </div>
                        <!--Grid column-->


                    </div>
                    <!--Grid row-->


                    <div class="row mt-lg-5">
                        <!-- First column -->
                        <div id="best1" class="col-md-6">
                            <!--Card-->
                            <div class="card-wrapper">
                                <div id="card-1" class="card card-rotating h-100" style="padding: 10px;">

                                    <!-- Front Side -->
                                    <div class="face front">


                                        <!-- Content -->
                                        <div class="card-body">

                                            <h4 class="section-heading mb-4 bold text-center">PORs </h4>

                                            <div class="table-responsive">
                                                <table class="table large-header">
                                                    <thead>
                                                    <tr>
                                                        <th class="font-weight-bold dark-grey-text"><strong>Rank</strong></th>
                                                        <th class="font-weight-bold dark-grey-text"><strong>Positive Behaviour</strong></th>
                                                        <th class="font-weight-bold dark-grey-text"><strong>#</strong></th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    <tbody>

                                                    {% for i in 1..3 %}
                                                    {%  if loop.index == 1 %}
                                                    <tr class="success-color">
                                                        {%  else  %}
                                                    <tr>
                                                        {% endif %}
                                                        <td>{{ i }}</td>

                                                        {% set behaviourName = 'NA' %}
                                                        {% set behaviourCount = 0 %}

                                                        {% if bestPors[loop.index0] is defined %}
                                                            {% set behaviourName = '[' ~ bestPors[loop.index0].behaviorLocation | upper ~ '] ' ~ bestPors[loop.index0].behavior %}
                                                            {% set behaviourCount = bestPors[loop.index0].countPOR %}
                                                        {% endif %}

                                                        <td>{{ behaviourName }}</td>
                                                        <td>{{ behaviourCount }}</td>
                                                        {% endfor %}
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                            <!-- Triggering button -->
                                            <div class="text-center"> <a class="rotate-btn" data-card="card-1"><button type="button" class="btn btn-outline-primary btn-rounded waves-effect ">Bar Chart View</button></a></div>

                                            <!--<div style="height: 130px"></div>-->
                                        </div>
                                    </div>
                                    <!-- Front Side -->

                                    <!-- Back Side -->
                                    <div class="face back">
                                        <div class="card-body" style="padding-left: 50px; background-color:white;">

                                            <!-- Content -->
                                            <h4 class="section-heading mb-4 bold text-center"> PORs </h4>
                                            <!--<div class="row"><div class="col-md-12"><br></div></div>-->

                                            <div class="row"><canvas id="horizontalBar"></canvas></div>

                                            <div class="text-center" style="margin-top: 15px;">
                                                <a class="rotate-btn" data-card="card-1">
                                                    <button type="button" class="btn btn-outline-primary btn-rounded waves-effect">Table View</button>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Back Side -->

                                </div>
                            </div>
                            <!-- Rotating card -->                                        <!--/.Card-->
                        </div>

                        <div id="best" class="col-md-6">
                            <!--Card-->
                            <div class="card-wrapper">
                                <div id="card-2" class="card card-rotating h-100" style="padding: 10px;">

                                    <!-- Front Side -->
                                    <div class="face front">


                                        <!-- Content -->
                                        <div class="card-body">

                                            <h4 class="section-heading mb-4 bold text-center">ODRs </h4>

                                            <div class="table-responsive">
                                                <table class="table large-header">
                                                    <thead>
                                                    <tr>
                                                        <th class="font-weight-bold dark-grey-text"><strong>Rank</strong></th>
                                                        <th class="font-weight-bold dark-grey-text"><strong>Disruptive Behaviour</strong></th>
                                                        <th class="font-weight-bold dark-grey-text"><strong>#</strong></th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>
                                                    {#<tr class="warning-color">
                                                        <td>1</td>
                                                        <td>Tardy</td>
                                                        <td>5</td>
                                                    </tr>#}
                                                    {% for i in 1..3 %}
                                                    {%  if loop.index == 1 %}
                                                    <tr class="warning-color">
                                                        {%  else  %}
                                                    <tr>
                                                        {% endif %}
                                                        <td>{{ i }}</td>

                                                        {% set behaviourName = 'NA' %}
                                                        {% set behaviourCount = 0 %}

                                                        {% if bestOdrs[loop.index0] is defined %}
                                                            {% set behaviourName = bestOdrs[loop.index0].name %}
                                                            {% set behaviourCount = bestOdrs[loop.index0].countODR %}
                                                        {% endif %}

                                                        <td>{{ behaviourName }}</td>
                                                        <td>{{ behaviourCount }}</td>
                                                        {% endfor %}
                                                    </tr>
                                                    </tbody>
                                                </table>
                                            </div>

                                            <!-- Triggering button -->
                                            <div class="text-center"> <a class="rotate-btn" data-card="card-2"><button type="button" class="btn btn-outline-primary btn-rounded waves-effect ">Bar Chart View</button></a></div>
                                        </div>
                                    </div>
                                    <!-- Front Side -->

                                    <!-- Back Side -->
                                    <div class="face back">
                                        <div class="card-body" style="padding-left: 50px; background-color: white;">

                                            <!-- Content -->
                                            <h4 class="section-heading mb-4 bold text-center"> ODRs </h4>
                                            <div class="row"><div class="col-md-12"><br></div></div>

                                            <div class="row"><canvas id="horizontalBar2"></canvas></div>

                                            <div class="text-center">
                                                <a class="rotate-btn" data-card="card-2">
                                                    <button type="button" class="btn btn-outline-primary btn-rounded waves-effect">Table View</button>
                                                </a>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Back Side -->

                                </div>
                            </div>
                            <!-- Rotating card -->                                        <!--/.Card-->
                        </div>




                    </div>





                    <div class="row mt-lg-5">
                        <div class="col-md-6">
                            <!--Card-->
                            <div class="card card-cascade cascading-admin-card">

                                <h4 class="section-heading mb-4 bold text-center">Cico Session </h4>

                                <canvas id="lineChart"></canvas>


                                <!--/.Card content-->

                            </div>
                            <!--/.Card-->
                        </div>


                        <div class="col-md-6">

                            <div class="card card-cascade cascading-admin-card example-1 scrollbar-ripe-malinka">

                                <div class="card-body">
                                    <h4 class="section-heading mb-4 bold text-center">List of Rewards </h4>

                                    <div class="table-responsive">

                                        <table class="table">

                                            <thead>
                                            <tr>
                                                <th class="font-weight-bold dark-grey-text">Status</th>
                                                <th class="font-weight-bold dark-grey-text">Name</th>
                                                <th class="font-weight-bold dark-grey-text">Value</th>
                                            </tr>
                                            </thead>
                                            <tbody>
                                            {% for reward in rewards%}
                                                <tr>
                                                    <td>{% if student.points >= reward.value %}<span class="badge green">Available</span>{% else %}<span class="badge grey">Unvailable</span>{% endif %}</td>
                                                    <td>{{ reward.name }}</td>
                                                    <td>{{ reward.value }}</td>
                                                </tr>
                                            {% endfor %}
                                            </tbody>
                                        </table>

                                    </div>

                                </div>
                            </div>
                        </div>
                    </div>



                </section>
                <!--Section: Chart-->

            </div>
            <!--/.Card-->

        </section>
        <!--Section: Analytical panel-->









    </div>

{% endblock %}



{% block javascripts %}
    {{ parent () }}


    <script>
        $(".button-collapse").sideNav();

        var container = document.querySelector('.custom-scrollbar');
        Ps.initialize(container, {
            wheelSpeed: 2,
            wheelPropagation: true,
            minScrollbarLength: 20
        });
    </script>


    <script>
        //doughnut
        var ctxD = document.getElementById("doughnutChart").getContext('2d');
        var myLineChart = new Chart(ctxD, {
            type: 'doughnut',
            data: {
                labels: ["ODR", "POR"],
                datasets: [{
                    data: [{% set sumOdr = 0 %}{% for behavior in odrs %}{% set sumOdr= sumOdr + behavior.countODR %}{% endfor %}{{ sumOdr }}
                        , {% set sumPor = 0 %}{% for behavior in pors %}{% set sumPor= sumPor + behavior.countPOR %}{% endfor %}{{ sumPor }}],
                    backgroundColor: ["#F7464A", "#5cbf8e"],
                    hoverBackgroundColor: ["#FF5A5E", "#5cbf8e"]
                }]
            },
            options: {
                responsive: true
            }
        });

    </script>

    <script>
        //line
        var ctxL = document.getElementById("lineChart").getContext('2d');
        var myLineChart = new Chart(ctxL, {
            type: 'line',
            data: {
                labels: [{% for cico in cicos %}"{{ cico.fillInDate | date('Y-m-d') }}"{% if loop.index != cicos | length %},{% endif %}{% endfor %}],
                datasets: [{
                    label: "Line Goal",
                    data: [{% for cico in cicos %}"{{ cico.threshold }}"{% if loop.index != cicos | length %},{% endif %}{% endfor %}],
                    backgroundColor: [
                        'rgba(105, 0, 132, .2)',
                    ],
                    borderColor: [
                        'rgba(200, 99, 132, .7)',
                    ],
                    borderWidth: 2
                },
                    {
                        label: "Data",
                        data: [{% for cico in cicos %}"{{ cico.sumDatas }}"{% if loop.index != cicos | length %},{% endif %}{% endfor %}],
                        backgroundColor: [
                            'rgba(0, 137, 132, .2)',
                        ],
                        borderColor: [
                            'rgba(0, 10, 130, .7)',
                        ],
                        borderWidth: 2
                    }
                ]
            },
            options: {
                responsive: true
            }
        });

    </script>

    <script>
        new Chart(document.getElementById("horizontalBar"), {
            "type": "horizontalBar",
            "data": {
                labels: [{% for behavior in pors %}"[{{ behavior.behaviorLocation | upper }}] {{ behavior.behavior }}"{% if loop.index != pors | length %},{% endif %}{% endfor %}],
                datasets: [{
                    label: '# of POR',
                    data: [{% focr behavior in pors %}"{{ behavior.countPOR }}"{% if loop.index != pors | length %},{% endif %}{% endfor %}],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },
            "options": {
                "scales": {
                    "xAxes": [{
                        "ticks": {
                            "beginAtZero": true
                        }
                    }]
                }
            }
        });

    </script>
    <script>
        new Chart(document.getElementById("horizontalBar2"), {
            "type": "horizontalBar",
            "data": {
                labels: [{% for behavior in odrs %}"{{ behavior.name }}"{% if loop.index != odrs | length %},{% endif %}{% endfor %}],
                datasets: [{
                    label: '# of ODR',
                    data: [{% for behavior in odrs %}"{{ behavior.countODR }}"{% if loop.index != odrs | length %},{% endif %}{% endfor %}],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                }]
            },

            "options": {
                "scales": {
                    "xAxes": [{
                        "ticks": {
                            "beginAtZero": true
                        }
                    }]
                }
            }
        });

    </script>

{% endblock %}
